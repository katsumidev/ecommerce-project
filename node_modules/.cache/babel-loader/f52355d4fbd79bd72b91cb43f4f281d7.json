{"ast":null,"code":"import _regeneratorRuntime from\"/home/twilightmoon/Documents/Projects/ecommerce-project/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/twilightmoon/Documents/Projects/ecommerce-project/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/twilightmoon/Documents/Projects/ecommerce-project/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState,useRef}from\"react\";import{Link,useNavigate,useParams}from\"react-router-dom\";import{BsGeoAlt,RiTruckLine}from\"../../styles/Icons\";import Rating from\"@material-ui/lab/Rating\";import ImageGallery from\"react-image-gallery\";import cep from\"cep-promise\";import\"./styles.css\";import ProductCard from\"../../components/ProductCard\";import{Container,PictureWrapper,ProductInfo,SellerInfoWrapper,SellerInfo,Picture,DeliveryInfo,BuyNowBtn,AddToCartBtn,Delivery,Description,BuyBtns,SimilarProducts,CustomHr,ProductsList,MobilePicture}from\"./styles\";import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function DetailsPage(){var _useState=useState({}),_useState2=_slicedToArray(_useState,2),productData=_useState2[0],setProductData=_useState2[1];var _useState3=useState({data:[]}),_useState4=_slicedToArray(_useState3,2),similarProducts=_useState4[0],setSimilarProducts=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),logged=_useState6[0],setLogged=_useState6[1];var _useState7=useState({}),_useState8=_slicedToArray(_useState7,2),userData=_useState8[0],setUserData=_useState8[1];var _useState9=useState(\"\"),_useState10=_slicedToArray(_useState9,2),currentImageUrl=_useState10[0],setCurrentImage=_useState10[1];var _useState11=useState(window.innerWidth>1000),_useState12=_slicedToArray(_useState11,2),isDesktop=_useState12[0],setDesktop=_useState12[1];var _useState13=useState({}),_useState14=_slicedToArray(_useState13,2),locationInfo=_useState14[0],setLocationInfo=_useState14[1];var _useState15=useState(1),_useState16=_slicedToArray(_useState15,2),buyQuantity=_useState16[0],setBuyQuantity=_useState16[1];var _useParams=useParams(),productId=_useParams.productId;var updateMedia=function updateMedia(){setDesktop(window.innerWidth>500);};useEffect(function(){window.addEventListener(\"resize\",updateMedia);return function(){return window.removeEventListener(\"resize\",updateMedia);};});useEffect(function(){fetch(\"\".concat(process.env.REACT_APP_SERVER_URL,\"/product/consult?id=\").concat(productId),{method:\"get\",headers:{\"Content-Type\":\"application/json\",Accept:\"application/json\"}}).then(/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(res){var data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return res.json();case 2:data=_context.sent;_context.t0=res.status;_context.next=_context.t0===404?6:_context.t0===200?8:11;break;case 6:alert(\"Produto não encontrado\");return _context.abrupt(\"break\",11);case 8:setProductData(data);setCurrentImage(data.image[0].original);return _context.abrupt(\"break\",11);case 11:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}());},[]);useEffect(function(){fetch(\"\".concat(process.env.REACT_APP_SERVER_URL,\"/auth/consult\"),{method:\"get\",headers:{\"Content-Type\":\"application/json\",Accept:\"application/json\",Authorization:\"Bearer \".concat(localStorage.getItem(\"access_token\"))}}).then(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(res){var data;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return res.json();case 2:data=_context2.sent;_context2.t0=res.status;_context2.next=_context2.t0===200?6:9;break;case 6:setLogged(!logged);setUserData(data);return _context2.abrupt(\"break\",9);case 9:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x2){return _ref2.apply(this,arguments);};}());},[]);useEffect(function(){fetch(\"\".concat(process.env.REACT_APP_SERVER_URL,\"/product/consult_similar_products?category=\").concat(productData.category,\"&id=\").concat(productId),{method:\"get\"}).then(/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(res){var data;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return res.json();case 2:data=_context3.sent;_context3.t0=res.status;_context3.next=_context3.t0===200?6:8;break;case 6:setSimilarProducts({data:data});return _context3.abrupt(\"break\",8);case 8:case\"end\":return _context3.stop();}}},_callee3);}));return function(_x3){return _ref3.apply(this,arguments);};}());},[productData]);function addToCart(){if(logged){fetch(\"\".concat(process.env.REACT_APP_SERVER_URL,\"/cart/addToCart\"),{method:\"post\",headers:{\"Content-Type\":\"application/json\",Authorization:\"Bearer \".concat(localStorage.getItem(\"access_token\"))},body:JSON.stringify({productId:productId,quantity:buyQuantity})}).then(/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(res){return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.t0=res.status;_context4.next=_context4.t0===200?3:5;break;case 3:alert(\"Item adicionado ao carrinho!\",res);return _context4.abrupt(\"break\",5);case 5:case\"end\":return _context4.stop();}}},_callee4);}));return function(_x4){return _ref4.apply(this,arguments);};}());}else{alert(\"Logue para usar o carrinho!\");}}useEffect(function(){cep(userData.cep).then(function(res){setLocationInfo(res);});},[userData]);var setView=function setView(event,index){setCurrentImage(productData.image[index].original);};return/*#__PURE__*/_jsxs(Container,{children:[/*#__PURE__*/_jsx(PictureWrapper,{children:productData.image!=undefined?/*#__PURE__*/_jsx(_Fragment,{children:isDesktop?/*#__PURE__*/_jsxs(_Fragment,{children:[\" \",/*#__PURE__*/_jsx(Picture,{enlargedImageContainerClassName:\"large-image\",hoverDelayInMs:0,smallImage:{src:currentImageUrl,width:480,height:480},largeImage:{src:currentImageUrl,width:1200,height:1800}}),/*#__PURE__*/_jsx(ImageGallery,{items:productData.image,thumbnailClass:\"thumb\",onThumbnailClick:setView,showFullscreenButton:false,showPlayButton:false,showNav:false})]}):/*#__PURE__*/_jsx(MobilePicture,{src:productData.image[0].original})}):/*#__PURE__*/_jsx(_Fragment,{})}),/*#__PURE__*/_jsxs(ProductInfo,{children:[/*#__PURE__*/_jsx(\"h2\",{children:productData.name}),/*#__PURE__*/_jsx(Rating,{name:\"half-rating\",defaultValue:4.7,size:\"medium\",precision:0.5,readOnly:true}),/*#__PURE__*/_jsxs(\"h1\",{children:[\"$ \",productData.price]}),/*#__PURE__*/_jsx(\"h4\",{children:\"+ \".concat(productData.portion,\"x $\").concat((productData.price/productData.portion).toFixed(2))}),/*#__PURE__*/_jsx(\"hr\",{}),/*#__PURE__*/_jsxs(\"ul\",{children:[/*#__PURE__*/_jsxs(\"li\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Brand: \"}),/*#__PURE__*/_jsx(\"span\",{children:productData.brand})]}),/*#__PURE__*/_jsxs(\"li\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Category: \"}),/*#__PURE__*/_jsx(\"span\",{children:productData.category})]}),/*#__PURE__*/_jsxs(\"li\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Tags: \"}),productData.tags!=undefined?productData.tags.map(function(t,index){return/*#__PURE__*/_jsx(\"span\",{children:(index?\", \":\"\")+t},\"\".concat(index));}):/*#__PURE__*/_jsx(_Fragment,{})]})]})]}),/*#__PURE__*/_jsx(SellerInfoWrapper,{children:/*#__PURE__*/_jsx(SellerInfo,{children:/*#__PURE__*/_jsxs(\"ul\",{children:[/*#__PURE__*/_jsx(\"li\",{children:/*#__PURE__*/_jsxs(\"h2\",{children:[\"$ \",productData.price]})}),/*#__PURE__*/_jsx(\"li\",{children:productData.deliveryPrice>0?/*#__PURE__*/_jsxs(DeliveryInfo,{children:[/*#__PURE__*/_jsx(RiTruckLine,{size:25}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Shipping price: $ \",productData.deliveryPrice]})]}):/*#__PURE__*/_jsxs(DeliveryInfo,{children:[/*#__PURE__*/_jsx(RiTruckLine,{size:25,fill:\"var(--accent-color)\"}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Shipping \",/*#__PURE__*/_jsx(\"a\",{children:\"FREE\"})]})]})}),/*#__PURE__*/_jsx(\"li\",{children:/*#__PURE__*/_jsxs(DeliveryInfo,{children:[/*#__PURE__*/_jsx(BsGeoAlt,{size:20}),logged?/*#__PURE__*/_jsx(Delivery,{children:userData.cep?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"p\",{children:[\"Deliver to \",userData.name,\",\"]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"b\",{children:locationInfo.city}),\" \",locationInfo.cep]})]}):/*#__PURE__*/_jsx(\"p\",{children:\"You need to register an address!\"})}):/*#__PURE__*/_jsx(\"p\",{children:/*#__PURE__*/_jsx(Link,{to:\"/login\",children:\"Login or register!\"})})]})}),/*#__PURE__*/_jsx(\"li\",{children:productData.countInStock>0?/*#__PURE__*/_jsx(\"h2\",{children:\"In Stock!\"}):/*#__PURE__*/_jsx(\"h2\",{children:\"Out of Stock.\"})}),/*#__PURE__*/_jsx(\"li\",{children:productData.countInStock>0?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Quantity:\"}),/*#__PURE__*/_jsx(\"select\",{onChange:function onChange(e){return setBuyQuantity(parseInt(e.target.value));},className:\"quantity\",children:Array.from(Array(productData.countInStock).keys()).map(function(i){return i>0&&i<6&&/*#__PURE__*/_jsx(\"option\",{value:i,children:i});})}),/*#__PURE__*/_jsxs(\"sub\",{children:[\"(\",productData.countInStock,\" in stock!)\"]})]}):/*#__PURE__*/_jsx(_Fragment,{})}),/*#__PURE__*/_jsx(\"li\",{children:/*#__PURE__*/_jsxs(BuyBtns,{children:[/*#__PURE__*/_jsx(BuyNowBtn,{type:\"button\",value:\"Buy Now\"}),/*#__PURE__*/_jsx(AddToCartBtn,{type:\"button\",value:\"Add to Cart\",onClick:function onClick(){return addToCart();}})]})})]})})}),/*#__PURE__*/_jsx(Description,{children:productData.description}),/*#__PURE__*/_jsxs(SimilarProducts,{children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Similar products you may like:\"}),/*#__PURE__*/_jsx(ProductsList,{children:similarProducts.data.slice(0,4).map(function(p){return/*#__PURE__*/_jsx(\"li\",{children:/*#__PURE__*/_jsx(ProductCard,{redirect:function redirect(){return window.location.href=p._id;},imgsrc:p.image[0].original,title:p.name,brand:p.brand,price:\"R$ \".concat(p.price),portion:\"\".concat(p.portion,\"x R$\").concat((p.price/p.portion).toFixed(2),\" sem juros\")},p._id)});})})]})]});}export default DetailsPage;","map":{"version":3,"sources":["/home/twilightmoon/Documents/Projects/ecommerce-project/src/pages/DetailsPage/index.js"],"names":["React","useEffect","useState","useRef","Link","useNavigate","useParams","BsGeoAlt","RiTruckLine","Rating","ImageGallery","cep","ProductCard","Container","PictureWrapper","ProductInfo","SellerInfoWrapper","SellerInfo","Picture","DeliveryInfo","BuyNowBtn","AddToCartBtn","Delivery","Description","BuyBtns","SimilarProducts","CustomHr","ProductsList","MobilePicture","DetailsPage","productData","setProductData","data","similarProducts","setSimilarProducts","logged","setLogged","userData","setUserData","currentImageUrl","setCurrentImage","window","innerWidth","isDesktop","setDesktop","locationInfo","setLocationInfo","buyQuantity","setBuyQuantity","productId","updateMedia","addEventListener","removeEventListener","fetch","process","env","REACT_APP_SERVER_URL","method","headers","Accept","then","res","json","status","alert","image","original","Authorization","localStorage","getItem","category","addToCart","body","JSON","stringify","quantity","setView","event","index","undefined","smallImage","src","width","height","largeImage","name","price","portion","toFixed","brand","tags","map","t","deliveryPrice","city","countInStock","e","parseInt","target","value","Array","from","keys","i","description","slice","p","location","href","_id"],"mappings":"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","sourcesContent":["import React, { useEffect, useState, useRef } from \"react\";\nimport { Link, useNavigate, useParams } from \"react-router-dom\";\nimport { BsGeoAlt, RiTruckLine } from \"../../styles/Icons\";\nimport Rating from \"@material-ui/lab/Rating\";\nimport ImageGallery from \"react-image-gallery\";\nimport cep from \"cep-promise\";\nimport \"./styles.css\";\nimport ProductCard from \"../../components/ProductCard\";\nimport {\n  Container,\n  PictureWrapper,\n  ProductInfo,\n  SellerInfoWrapper,\n  SellerInfo,\n  Picture,\n  DeliveryInfo,\n  BuyNowBtn,\n  AddToCartBtn,\n  Delivery,\n  Description,\n  BuyBtns,\n  SimilarProducts,\n  CustomHr,\n  ProductsList,\n  MobilePicture,\n} from \"./styles\";\n\nfunction DetailsPage() {\n  const [productData, setProductData] = useState({});\n  const [similarProducts, setSimilarProducts] = useState({ data: [] });\n  const [logged, setLogged] = useState(false);\n  const [userData, setUserData] = useState({});\n  const [currentImageUrl, setCurrentImage] = useState(\"\");\n  const [isDesktop, setDesktop] = useState(window.innerWidth > 1000);\n  const [locationInfo, setLocationInfo] = useState({});\n  const [buyQuantity, setBuyQuantity] = useState(1);\n  const { productId } = useParams();\n\n  const updateMedia = () => {\n    setDesktop(window.innerWidth > 500);\n  };\n\n  useEffect(() => {\n    window.addEventListener(\"resize\", updateMedia);\n    return () => window.removeEventListener(\"resize\", updateMedia);\n  });\n\n  useEffect(() => {\n    fetch(\n      `${process.env.REACT_APP_SERVER_URL}/product/consult?id=${productId}`,\n      {\n        method: \"get\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          Accept: \"application/json\",\n        },\n      }\n    ).then(async (res) => {\n      let data = await res.json();\n\n      switch (res.status) {\n        case 404:\n          alert(\"Produto não encontrado\");\n          break;\n        case 200:\n          setProductData(data);\n          setCurrentImage(data.image[0].original);\n          break;\n      }\n    });\n  }, []);\n\n  useEffect(() => {\n    fetch(`${process.env.REACT_APP_SERVER_URL}/auth/consult`, {\n      method: \"get\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        Accept: \"application/json\",\n        Authorization: `Bearer ${localStorage.getItem(\"access_token\")}`,\n      },\n    }).then(async (res) => {\n      let data = await res.json();\n\n      switch (res.status) {\n        case 200:\n          setLogged(!logged);\n          setUserData(data);\n          break;\n      }\n    });\n  }, []);\n\n  useEffect(() => {\n    fetch(\n      `${process.env.REACT_APP_SERVER_URL}/product/consult_similar_products?category=${productData.category}&id=${productId}`,\n      {\n        method: \"get\",\n      }\n    ).then(async (res) => {\n      let data = await res.json();\n\n      switch (res.status) {\n        case 200:\n          setSimilarProducts({ data: data });\n          break;\n      }\n    });\n  }, [productData]);\n\n  function addToCart() {\n    if (logged) {\n      fetch(`${process.env.REACT_APP_SERVER_URL}/cart/addToCart`, {\n        method: \"post\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          Authorization: `Bearer ${localStorage.getItem(\"access_token\")}`,\n        },\n        body: JSON.stringify({\n          productId: productId,\n          quantity: buyQuantity,\n        }),\n      }).then(async (res) => {\n        switch (res.status) {\n          case 200:\n            alert(\"Item adicionado ao carrinho!\", res);\n            break;\n        }\n      });\n    } else {\n      alert(\"Logue para usar o carrinho!\");\n    }\n  }\n\n  useEffect(() => {\n    cep(userData.cep).then((res) => {\n      setLocationInfo(res);\n    });\n  }, [userData]);\n\n  const setView = (event, index) => {\n    setCurrentImage(productData.image[index].original);\n  };\n\n  return (\n    <Container>\n      <PictureWrapper>\n        {productData.image != undefined ? (\n          <>\n            {isDesktop ? (\n              <>\n                {\" \"}\n                <Picture\n                  enlargedImageContainerClassName=\"large-image\"\n                  hoverDelayInMs={0}\n                  {...{\n                    smallImage: {\n                      src: currentImageUrl,\n                      width: 480,\n                      height: 480,\n                    },\n                    largeImage: {\n                      src: currentImageUrl,\n                      width: 1200,\n                      height: 1800,\n                    },\n                  }}\n                />\n                <ImageGallery\n                  items={productData.image}\n                  thumbnailClass=\"thumb\"\n                  onThumbnailClick={setView}\n                  showFullscreenButton={false}\n                  showPlayButton={false}\n                  showNav={false}\n                />\n              </>\n            ) : (\n              <MobilePicture src={productData.image[0].original} />\n            )}\n          </>\n        ) : (\n          <></>\n        )}\n      </PictureWrapper>\n      <ProductInfo>\n        <h2>{productData.name}</h2>\n        <Rating\n          name=\"half-rating\"\n          defaultValue={4.7}\n          size=\"medium\"\n          precision={0.5}\n          readOnly\n        />\n        <h1>$ {productData.price}</h1>\n        <h4>{`+ ${productData.portion}x $${(\n          productData.price / productData.portion\n        ).toFixed(2)}`}</h4>\n        <hr />\n        <ul>\n          <li>\n            <strong>Brand: </strong>\n            <span>{productData.brand}</span>\n          </li>\n          <li>\n            <strong>Category: </strong>\n            <span>{productData.category}</span>\n          </li>\n          <li>\n            <strong>Tags: </strong>\n            {productData.tags != undefined ? (\n              productData.tags.map((t, index) => {\n                return <span key={`${index}`}>{(index ? \", \" : \"\") + t}</span>;\n              })\n            ) : (\n              <></>\n            )}\n          </li>\n        </ul>\n      </ProductInfo>\n      <SellerInfoWrapper>\n        <SellerInfo>\n          <ul>\n            <li>\n              <h2>$ {productData.price}</h2>\n            </li>\n            <li>\n              {productData.deliveryPrice > 0 ? (\n                <DeliveryInfo>\n                  <RiTruckLine size={25} />\n                  <p>Shipping price: $ {productData.deliveryPrice}</p>\n                </DeliveryInfo>\n              ) : (\n                <DeliveryInfo>\n                  <RiTruckLine size={25} fill=\"var(--accent-color)\" />\n                  <p>\n                    Shipping <a>FREE</a>\n                  </p>\n                </DeliveryInfo>\n              )}\n            </li>\n            <li>\n              <DeliveryInfo>\n                <BsGeoAlt size={20} />\n                {logged ? (\n                  <Delivery>\n                    {userData.cep ? (\n                      <>\n                        <p>Deliver to {userData.name},</p>\n                        <p>\n                          <b>{locationInfo.city}</b> {locationInfo.cep}\n                        </p>\n                      </>\n                    ) : (\n                      <p>You need to register an address!</p>\n                    )}\n                  </Delivery>\n                ) : (\n                  <p>\n                    <Link to=\"/login\">Login or register!</Link>\n                  </p>\n                )}\n              </DeliveryInfo>\n            </li>\n            <li>\n              {productData.countInStock > 0 ? (\n                <h2>In Stock!</h2>\n              ) : (\n                <h2>Out of Stock.</h2>\n              )}\n            </li>\n            <li>\n              {productData.countInStock > 0 ? (\n                <>\n                  <strong>Quantity:</strong>\n                  <select\n                    onChange={(e) => setBuyQuantity(parseInt(e.target.value))}\n                    className=\"quantity\"\n                  >\n                    {Array.from(Array(productData.countInStock).keys()).map(\n                      (i) => {\n                        return i > 0 && i < 6 && <option value={i}>{i}</option>;\n                      }\n                    )}\n                  </select>\n                  <sub>({productData.countInStock} in stock!)</sub>\n                </>\n              ) : (\n                <></>\n              )}\n            </li>\n            <li>\n              <BuyBtns>\n                <BuyNowBtn type=\"button\" value=\"Buy Now\" />\n                <AddToCartBtn\n                  type=\"button\"\n                  value=\"Add to Cart\"\n                  onClick={() => addToCart()}\n                />\n              </BuyBtns>\n            </li>\n          </ul>\n        </SellerInfo>\n      </SellerInfoWrapper>\n      <Description>{productData.description}</Description>\n      <SimilarProducts>\n        <h3>Similar products you may like:</h3>\n        <ProductsList>\n          {similarProducts.data.slice(0, 4).map((p) => {\n            return (\n              <li>\n                <ProductCard\n                  key={p._id}\n                  redirect={() => (window.location.href = p._id)}\n                  imgsrc={p.image[0].original}\n                  title={p.name}\n                  brand={p.brand}\n                  price={`R$ ${p.price}`}\n                  portion={`${p.portion}x R$${(p.price / p.portion).toFixed(\n                    2\n                  )} sem juros`}\n                />\n              </li>\n            );\n          })}\n        </ProductsList>\n      </SimilarProducts>\n    </Container>\n  );\n}\n\nexport default DetailsPage;\n"]},"metadata":{},"sourceType":"module"}